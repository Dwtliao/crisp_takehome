<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Happy Pastures Creamery - Restaurant Prospecting</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>ğŸ§€ Happy Pastures Creamery</h1>
        <p>Find your next restaurant prospect</p>
    </header>

    <div class="container">
        <!-- Location Input Screen -->
        <div id="location-screen" class="section">
            <h2>Where are you?</h2>

            <button id="gps-btn" class="btn">ğŸ“ Use My Current Location</button>

            <div style="text-align: center; margin: 20px 0; color: #999;">or</div>

            <div class="location-input">
                <label for="address-input">Enter an address:</label>
                <input
                    type="text"
                    id="address-input"
                    placeholder="e.g., 505 Main St, Evanston, IL"
                >
                <div id="address-history" class="address-history"></div>
            </div>

            <button id="address-btn" class="btn btn-secondary">Search This Address</button>

            <div id="error-msg" class="error hidden"></div>
        </div>

        <!-- Loading Screen -->
        <div id="loading-screen" class="section hidden">
            <div class="loading">
                <div class="spinner"></div>
                <p>Finding high-quality restaurant prospects...</p>
            </div>
        </div>

        <!-- Restaurant List Screen -->
        <div id="restaurant-list-screen" class="section hidden">
            <button id="change-location-btn" class="btn back-btn">ğŸ“ Change Location</button>
            <h2>Nearby Prospects</h2>
            <p id="search-info" style="color: #666; margin-bottom: 10px;"></p>
            <div id="cache-status" class="cache-status hidden"></div>


            <p id="memory-info" style="font-size: 0.85em; color: #888; margin-bottom: 10px;">
                <span id="memory-stats"></span>
                <a href="#" onclick="event.preventDefault(); viewRejectedRestaurants();" style="color: #666; text-decoration: underline; margin-left: 10px;">View list</a>
                <a href="#" onclick="event.preventDefault(); clearRejectedRestaurants();" style="color: #666; text-decoration: underline; margin-left: 10px;">Clear memory</a>
            </p>
            <ul id="restaurant-list" class="restaurant-list"></ul>
        </div>

        <!-- Pitch Detail Screen -->
        <div id="pitch-screen" class="section pitch-view">
            <button id="back-btn" class="btn back-btn">â† Restaurant List</button>

            <!-- TTS Controls -->
            <div id="tts-controls" class="tts-controls hidden">
                <button id="tts-play-btn" class="btn btn-tts">
                    ğŸ”Š Listen to Pitch
                </button>
                <div id="tts-player" class="tts-player hidden">
                    <button id="tts-pause-btn" class="btn btn-small btn-tts-control">â¸ï¸ Pause</button>
                    <button id="tts-stop-btn" class="btn btn-small btn-tts-control">â¹ï¸ Stop</button>
                    <button id="tts-replay-btn" class="btn btn-small btn-tts-control">ğŸ” Replay</button>
                    <div class="tts-speed">
                        <label>Speed:</label>
                        <button class="speed-btn" data-speed="0.75">0.75x</button>
                        <button class="speed-btn active" data-speed="1">1x</button>
                        <button class="speed-btn" data-speed="1.25">1.25x</button>
                        <button class="speed-btn" data-speed="1.5">1.5x</button>
                    </div>
                    <div id="tts-status" class="tts-status">Ready to play</div>
                </div>
            </div>

            <!-- Voice Notes Section -->
            <div id="voice-notes-section" class="voice-notes-section hidden">
                <h3 style="color: #2c5f2d; margin-bottom: 15px;">ğŸ“ Notes</h3>

                <!-- Existing notes display -->
                <div id="existing-notes"></div>

                <!-- Add new note -->
                <button id="add-note-btn" class="btn btn-voice-note">
                    ğŸ¤ Add Voice Note
                </button>

                <!-- Recording UI -->
                <div id="recording-ui" class="recording-ui hidden">
                    <div class="recording-indicator">
                        <span class="recording-dot"></span>
                        <span>Recording...</span>
                    </div>
                    <div id="live-transcript" class="live-transcript">
                        Listening...
                    </div>
                    <button id="stop-recording-btn" class="btn btn-small">
                        â¹ï¸ Stop Recording
                    </button>
                </div>
            </div>

            <div id="pitch-content"></div>

            <!-- Refine Pitch CTA -->
            <div id="refine-pitch-cta" class="refine-pitch-cta hidden">
                <!-- Saved Pitch Notice -->
                <div id="saved-pitch-notice" class="hidden" style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #2c5f2d;">
                    <strong>ğŸ’¾ Saved Pitches Available!</strong>
                    <p id="saved-pitch-list" style="margin: 8px 0 0 0; color: #666; font-size: 0.9em;"></p>
                </div>

                <!-- Save Original Pitch -->
                <div style="margin-bottom: 15px;">
                    <button id="save-original-pitch-btn" class="btn" style="background: #2c5f2d; color: white; padding: 12px; font-size: 1em; width: 100%;">
                        ğŸ’¾ Save Original Pitch
                    </button>
                    <div id="save-original-indicator" class="hidden" style="color: #2c5f2d; margin-top: 6px; font-weight: 600; text-align: center; font-size: 0.9em;">
                        âœ… Original pitch saved!
                    </div>
                </div>

                <h3>ğŸ”„ Want to Refine This Pitch?</h3>
                <p style="color: #666; margin-bottom: 15px;">
                    Get a version tailored to who you'll be talking to (Chef, Manager, or Front Desk)
                </p>
                <button id="go-to-refinement-btn" class="btn" style="background: #4a90e2; color: white; padding: 15px; font-size: 1.1em; width: 100%;">
                    Refine This Pitch â†’
                </button>
            </div>

            <div id="pitch-loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Generating your sales pitch...</p>
            </div>
        </div>

        <!-- Pitch Refinement Screen (Page 3) -->
        <div id="refinement-screen" class="section pitch-view hidden">
            <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                <button id="back-to-pitch-btn" class="btn back-btn" style="flex: 1;">â† Back to Original Pitch</button>
                <button id="back-to-list-from-refinement-top" class="btn back-btn" style="flex: 1; background: #666;">â† Restaurant List</button>
            </div>

            <!-- Restaurant Info Summary -->
            <div id="refinement-restaurant-info" style="margin-bottom: 20px;">
                <h2 id="refinement-restaurant-name"></h2>
                <p id="refinement-restaurant-address" style="color: #666; margin-bottom: 10px;"></p>

                <!-- Quick Actions at Top of Page 3 -->
                <div id="refinement-quick-actions" style="display: flex; gap: 8px; margin-bottom: 15px;">
                    <button id="refinement-directions-btn" class="btn btn-small" style="flex: 1; background: #4a90e2; color: white;">
                        ğŸ—ºï¸ Directions
                    </button>
                    <button id="refinement-reject-btn" class="btn btn-small btn-reject" style="flex: 1;">
                        âŒ Not Interested
                    </button>
                </div>
            </div>

            <!-- Refinement Selector -->
            <div class="refinement-selector">
                <h3>ğŸ”„ Refine For:</h3>
                <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">
                    Choose who you'll be talking to
                </p>

                <div class="refinement-buttons">
                    <button class="btn-refinement" data-persona="walking">
                        <span class="persona-icon">ğŸš¶</span>
                        <div class="persona-text">
                            <span class="persona-title">Walking (20s)</span>
                            <span class="persona-desc">Quick version to memorize</span>
                        </div>
                    </button>

                    <button class="btn-refinement" data-persona="chef">
                        <span class="persona-icon">ğŸ§‘â€ğŸ³</span>
                        <div class="persona-text">
                            <span class="persona-title">Chef</span>
                            <span class="persona-desc">Technical, culinary talk</span>
                        </div>
                    </button>

                    <button class="btn-refinement" data-persona="manager">
                        <span class="persona-icon">ğŸ‘”</span>
                        <div class="persona-text">
                            <span class="persona-title">Manager</span>
                            <span class="persona-desc">Business ROI, margins</span>
                        </div>
                    </button>

                    <button class="btn-refinement" data-persona="gatekeeper">
                        <span class="persona-icon">ğŸ¯</span>
                        <div class="persona-text">
                            <span class="persona-title">Host</span>
                            <span class="persona-desc">Quick gatekeeper pitch</span>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Refined Pitch Display -->
            <div id="refined-pitch-display" class="refined-pitch-display hidden">
                <div class="refined-pitch-header">
                    <h4 id="refined-pitch-label"></h4>
                </div>

                <!-- TTS Controls for Refined Pitch (TOP) -->
                <div class="tts-controls" style="margin: 20px 0;">
                    <button id="refined-tts-play-btn" class="btn btn-tts">
                        ğŸ”Š Listen to Refined Pitch
                    </button>
                    <div id="refined-tts-player" class="tts-player hidden">
                        <button id="refined-tts-pause-btn" class="btn btn-small btn-tts-control">â¸ï¸ Pause</button>
                        <button id="refined-tts-stop-btn" class="btn btn-small btn-tts-control">â¹ï¸ Stop</button>
                        <button id="refined-tts-replay-btn" class="btn btn-small btn-tts-control">ğŸ” Replay</button>
                        <div class="tts-speed">
                            <label>Speed:</label>
                            <button class="speed-btn refined-speed-btn" data-speed="0.75">0.75x</button>
                            <button class="speed-btn refined-speed-btn active" data-speed="1">1x</button>
                            <button class="speed-btn refined-speed-btn" data-speed="1.25">1.25x</button>
                            <button class="speed-btn refined-speed-btn" data-speed="1.5">1.5x</button>
                        </div>
                        <div id="refined-tts-status" class="tts-status">Ready to play</div>
                    </div>
                </div>

                <div id="refined-pitch-content" class="refined-pitch-content"></div>

                <!-- Micro-Refinements -->
                <div id="micro-refinements" class="micro-refinements" style="margin-top: 30px;">
                    <h4 style="color: #4a90e2; margin-bottom: 15px;">âœ¨ Fine-tune This Pitch:</h4>
                    <div class="micro-refinement-buttons">
                        <button class="btn-micro-refine" data-type="shorten">
                            ğŸ“ Shorten
                        </button>
                        <button class="btn-micro-refine" data-type="expand">
                            ğŸ“– Expand
                        </button>
                        <button class="btn-micro-refine" data-type="casual">
                            ğŸ’¬ More Casual
                        </button>
                        <button class="btn-micro-refine" data-type="formal">
                            ğŸ© More Formal
                        </button>
                        <button class="btn-micro-refine" data-type="strong_opener">
                            âš¡ Strong Opener
                        </button>
                    </div>
                </div>

                <!-- Save Pitch -->
                <div id="save-pitch-section" class="save-pitch-section" style="margin-top: 30px; text-align: center;">
                    <button id="save-pitch-btn" class="btn" style="background: #2c5f2d; color: white; padding: 15px; font-size: 1.1em;">
                        ğŸ’¾ Save This Version
                    </button>
                    <div id="saved-indicator" class="hidden" style="color: #2c5f2d; margin-top: 10px; font-weight: 600;">
                        âœ… Pitch saved! Will load automatically on next visit
                    </div>
                </div>

                <!-- Try Another Refinement -->
                <div style="margin-top: 30px; display: flex; gap: 10px;">
                    <button id="try-another-refinement-btn" class="btn" style="flex: 1; background: #666; color: white;">
                        â† Try Different Persona
                    </button>
                    <button id="back-to-list-from-refinement-bottom" class="btn" style="flex: 1; background: #666; color: white;">
                        â† Restaurant List
                    </button>
                </div>
            </div>

            <div id="refinement-loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Generating refined pitch...</p>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
